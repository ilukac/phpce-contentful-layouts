# Learn more about services, parameters and containers at
# https://symfony.com/doc/current/service_container.html
parameters:
    #parameter_name: value

services:
    # default configuration for services in *this* file
    _defaults:
        # automatically injects dependencies in your services
        autowire: false
        # automatically registers your services as commands, event subscribers, etc.
        autoconfigure: true
        # this means you cannot fetch services directly from the container via $container->get()
        # if you need to do this, you can override this setting on individual services
        public: false

    # makes classes in src/AppBundle available to be used as services
    # this creates a service per class whose id is the fully-qualified class name
    AppBundle\:
        resource: '../../src/AppBundle/*'
        # you can exclude directories or files
        # but if a service is unused, it's removed anyway
        exclude: '../../src/AppBundle/{Entity,Repository,Tests}'

    # controllers are imported separately to make sure they're public
    # and have a tag that allows actions to type-hint services
    AppBundle\Controller\:
        resource: '../../src/AppBundle/Controller'
        public: true
        tags: ['controller.service_arguments']

    # add more services, or override services that need manual wiring
    # AppBundle\Service\ExampleService:
    #     arguments:
    #         $someArgument: 'some_value'

    app.contentful_service:
        class: AppBundle\Service\Contentful
        arguments:
            - "%contentful.clients%"
            - "@service_container"
            - "@doctrine.orm.entity_manager"
        public: true

    app.routing.contentful_enhancer:
        class: AppBundle\RoutingEnhancer\ContentfulEnhancer
        arguments:
            - "@app.contentful_service"
        tags:
            -  { name: dynamic_router_route_enhancer, priority: 10 }

    app.content_browser.backend.contentful_entry:
        class: AppBundle\ContentBrowser\Backend\ContentfulBackend
        arguments:
            - "@app.contentful_service"
        tags:
            -  { name: netgen_content_browser.backend, item_type: contentful_entry }

    app.content_browser.template_value_provider.contentful_entry.created_at:
        class: AppBundle\ContentBrowser\Item\Entry\ColumnValueProvider\CreatedAt
        arguments:
            - "%netgen_content_browser.columns.date_format%"
        tags:
            - { name: netgen_content_browser.column_value_provider, identifier: contentful_entry\created_at }

    app.content_browser.template_value_provider.contentful_entry.updated_at:
        class: AppBundle\ContentBrowser\Item\Entry\ColumnValueProvider\UpdatedAt
        arguments:
            - "%netgen_content_browser.columns.date_format%"
        tags:
            - { name: netgen_content_browser.column_value_provider, identifier: contentful_entry\updated_at }

    app.content_browser.template_value_provider.contentful_entry.content_type:
        class: AppBundle\ContentBrowser\Item\Entry\ColumnValueProvider\ContentType
        tags:
            - { name: netgen_content_browser.column_value_provider, identifier: contentful_entry\content_type }

    app.block_manager.value_converter.contentful_entry:
        class: AppBundle\Layouts\Item\ValueConverter\ContentfulValueConverter
        public: false
        tags:
            - { name: netgen_block_manager.item.value_converter }

    app.block_manager.value_loader.contentful_entry:
        class: AppBundle\Layouts\Item\ValueLoader\ContentfulValueLoader
        public: false
        arguments:
            - "@app.contentful_service"
        tags:
            - { name: netgen_block_manager.item.value_loader, value_type: contentful_entry }

    app.collection.query_type.handler.contentful_search:
        class: AppBundle\Layouts\Collection\QueryType\Handler\ContentfulHandler
        arguments:
            - "@app.contentful_service"
        tags:
            - { name: netgen_block_manager.collection.query_type_handler, type: contentful_search }

    app.target_type.contentful_entry_target:
        class: AppBundle\Layouts\Resolver\TargetType\Entry
        tags:
            - { name: netgen_block_manager.layout.resolver.target_type }

    app.layout_resolver.form.target_type.mapper.contentful_entry_target:
        class: AppBundle\Layouts\Resolver\TargetType\FormMapper\Entry
        tags:
            - { name: netgen_block_manager.layout.resolver.form.target_type.mapper, target_type: contentful_entry }

    app.layout_resolver.target_handler.doctrine.contentful_entry_target:
        class: AppBundle\Layouts\Resolver\TargetHandler\Entry
        tags:
            - { name: netgen_block_manager.persistence.doctrine.layout_resolver.query_handler.target_handler, target_type: contentful_entry }

    app.target_type.contentful_space_target:
        class: AppBundle\Layouts\Resolver\TargetType\Space
        tags:
            - { name: netgen_block_manager.layout.resolver.target_type }

    app.layout_resolver.form.target_type.mapper.contentful_space_target:
        class: AppBundle\Layouts\Resolver\TargetType\FormMapper\Space
        arguments:
            - "@app.contentful_service"
        tags:
            - { name: netgen_block_manager.layout.resolver.form.target_type.mapper, target_type: contentful_space }

    app.layout_resolver.target_handler.doctrine.contentful_space_target:
        class: AppBundle\Layouts\Resolver\TargetHandler\Space
        tags:
            - { name: netgen_block_manager.persistence.doctrine.layout_resolver.query_handler.target_handler, target_type: contentful_space }

    app.contentful_service.twig_function.contentful:
        class: AppBundle\Twig\Extensions\ContentfulExtension
        arguments:
            - "@app.contentful_service"
        tags:
            - { name: twig.extension }

